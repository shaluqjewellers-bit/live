<script>
/* Seamless ticker duplicate */
document.getElementById("g2").innerHTML = document.getElementById("g1").innerHTML;

/* TradingView Symbol Info */
function addTV(symbol,id){
  const s=document.createElement("script");
  s.src="https://s3.tradingview.com/external-embedding/embed-widget-symbol-info.js";
  s.async=true;
  s.innerHTML=JSON.stringify({symbol:symbol,colorTheme:"dark",isTransparent:true,locale:"en"});
  document.getElementById(id).appendChild(s);
}
addTV("OANDA:XAUUSD","gold");
addTV("OANDA:XAGUSD","silver");

/* Dubai time helper (GST = UTC+4) */
function getDubaiDate(){
  const now = new Date();
  const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
  return new Date(utc + (4 * 60 * 60000));
}

/* Clock (Dubai time) */
function tickClock(){
  const d=getDubaiDate();
  const hh=String(d.getHours()).padStart(2,"0");
  const mm=String(d.getMinutes()).padStart(2,"0");
  document.getElementById("clock").textContent = `${hh}:${mm} GST`;
}
tickClock(); setInterval(tickClock, 10000);

/* Dubai winter market hours:
   OPEN 03:00 GST
   CLOSE 01:00 GST (next day)
   Closed only 01:00–03:00
*/
function updateDubaiMarket(){
  const d = getDubaiDate();
  const h = d.getHours();
  const m = d.getMinutes();

  let isOpen, diffMinutes;

  // closed window: 01:00–03:00
  if (h >= 1 && h < 3){
    isOpen = false;
    diffMinutes = ((3 - h) * 60) - m; // until 03:00
  } else {
    isOpen = true;

    // if 03:00–23:59 -> close at 01:00 next day
    if (h >= 3){
      diffMinutes = ((25 - h) * 60) - m; // until 01:00 next day
    } else {
      // 00:00–00:59 -> close at 01:00 same day
      diffMinutes = (60 - m);
    }
  }

  const hrs = Math.floor(diffMinutes / 60);
  const mins = diffMinutes % 60;

  const top = document.getElementById("marketTop");
  const eta = document.getElementById("marketETA");
  const dot = document.getElementById("statusDot");

  if (isOpen){
    top.textContent = "Market Open";
    eta.textContent = `Closes in ${hrs}h ${mins}m`;
    dot.style.background = "var(--open)";
    dot.style.boxShadow = "0 0 12px var(--open)";
  } else {
    top.textContent = "Market Closed";
    eta.textContent = `Opens in ${hrs}h ${mins}m`;
    dot.style.background = "var(--closed)";
    dot.style.boxShadow = "0 0 12px var(--closed)";
  }
}

updateDubaiMarket();
setInterval(updateDubaiMarket, 60000);
</script>
